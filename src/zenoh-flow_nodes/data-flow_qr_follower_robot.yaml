flow: qr_follower

vars:
  BASE_DIR_PATH: file:///home/usanz/zs_t3/t3_ws/src/follow_beacon/src/zenoh-flow_nodes

#configuration:
#  locator: 'tcp/127.0.0.1:7447'
#  mode: client

sources:
  - id : source_image
    descriptor : "{{ BASE_DIR_PATH }}/source_image_robot.yml"
  - id : source_scan
    configuration:
      Scan: rt/scan
    descriptor : "builtin://zenoh"
  - id : source_tf
    configuration:
      TF: rt/tf
    descriptor : "builtin://zenoh"
  - id : source_tf_static
    configuration:
      TF_static: rt/tf_static
    descriptor : "builtin://zenoh"
operators:
  - id : operator_qr_detector
    descriptor : "{{ BASE_DIR_PATH }}/operator_qr_detector.yml"
  - id : operator_lidar_vff
    descriptor : "{{ BASE_DIR_PATH }}/operator_lidar_vff.yml"
  - id : operator_driver
    descriptor : "{{ BASE_DIR_PATH }}/operator_driver.yml"
sinks:
  - id : sink_motors
    configuration:
      Twist: rt/cmd_vel
    descriptor : "builtin://zenoh"
  - id : sink_debug_markers
    configuration:
      Markers: rt/markers/forces
    descriptor : "builtin://zenoh"
  - id : sink_tf
    configuration:
      TF: rt/tf #or rt/tf_static if you don't want it to disappear
    descriptor : "builtin://zenoh"
  - id : sink_tf_static
    configuration:
      TF_static: rt/tf_static
    descriptor : "builtin://zenoh"
  - id : sink_debug_image
    configuration:
      DebugImage: rt/debug/image/qr_codes
    descriptor : "builtin://zenoh"

links:
- from:
    node : source_image
    output : Image
  to:
    node : operator_qr_detector
    input : Image

- from:
    node : source_tf
    output : TF
  to:
    node : operator_qr_detector
    input : TF

- from:
    node : source_tf_static
    output : TF_static
  to:
    node : operator_qr_detector
    input : TF_static

- from:
    node : source_tf_static
    output : TF_static
  to:
    node : operator_lidar_vff
    input : TF_static

- from:
    node : source_tf
    output : TF
  to:
    node : operator_lidar_vff
    input : TF

- from:
    node : operator_qr_detector
    output : DebugImage
  to:
    node : sink_debug_image
    input : DebugImage

- from:
    node : operator_qr_detector
    output : TF_static
  to:
    node : sink_tf_static
    input : TF_static

- from:
    node : source_scan
    output : Scan
  to:
    node : operator_lidar_vff
    input : Scan

- from:
    node : operator_lidar_vff
    output : Force
  to:
    node : operator_driver
    input : Force

- from:
    node : operator_lidar_vff
    output : Markers
  to:
    node : sink_debug_markers
    input : Markers

- from:
    node : operator_qr_detector
    output : TF
  to:
    node : sink_tf
    input : TF

- from:
    node : operator_driver
    output : Twist
  to:
    node : sink_motors
    input : Twist

mapping:
  source_image: turtlebot3
  operator_qr_detector: computer
  operator_lidar_vff: computer
  operator_driver: computer